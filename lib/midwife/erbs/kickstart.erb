###############################################################################
### Kickstart generated by midwife
###############################################################################
install
reboot
text
skipx

###############################################################################
### Misc
###############################################################################
url --url <%= distro.url %>
rootpw --iscrypted <%= password %>
firstboot --disable

###############################################################################
### Partitioning
###############################################################################
<%= partitions.emit %>

###############################################################################
### Networking
###############################################################################
<% interfaces.each do |iface| %>
<%= iface.emit %>
<% end %>
firewall --disabled

###############################################################################
### Environment
###############################################################################
lang en_US
keyboard us
timezone <%= timezone %>

###############################################################################
### SELinux
###############################################################################
selinux --<%= selinux %>

###############################################################################
### Packages
###############################################################################
%packages 
@core
curl
openssh-clients
openssh-server
finger
pciutils
yum
at
acpid
vixie-cron
cronie-noanacron
crontabs
logrotate
ntp
ntpdate
tmpwatch
rsync
mailx
which
wget
man

###############################################################################
### Post
###############################################################################
%post --log=/root/midwife-post.log
chvt 3
echo "Executing post installation"

echo "Setting hostname"
cat > /etc/sysconfig/network << 'EOF'
NETWORKING=yes
HOSTNAME=<%= name %>
EOF
source /etc/sysconfig/network
/bin/hostname <%= name %>
cat > /etc/hosts << 'EOF'
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
EOF

<%= resolv_conf %>

echo "Contacting midwife to notify of a successful install"
/usr/bin/curl http://<%= Midwife.configuration.server %>/notify/<%= name %>/installed


echo
echo "Synchronizing clock"
ntpdate <%= Midwife.configuration.ntp_server %>

echo
echo "Creating SSH keys"
mkdir -p /root/.ssh
cd /root/.ssh
chmod 700 /root/.ssh
ssh-keygen -f id_rsa -t rsa -N ''
touch authorized_keys
chmod 600 authorized_keys
cat > /root/.ssh/authorized_keys << 'EOF'
<%= Midwife.configuration.authorized_keys %>
EOF

<%= bootstrap %>
